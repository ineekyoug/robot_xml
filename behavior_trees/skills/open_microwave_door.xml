<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4"
      main_tree_to_execute="OpenMicowaveDoor">
  <BehaviorTree ID="OpenMicowaveDoor">
    <Sequence>
      <NavAction server_name="/base_navigate"
                 server_timeout="60000"
                 action_name="navigation"
                 type="0"
                 target_pose="-0.0371;-0.0377;-0.124"
                 success="{nav_success}"
                 msg="{nav_msg}"/>
      <Parallel failure_count="1"
                success_count="2">
        <SpeakService service_name="/speak"
                      server_timeout="5000"
                      speech_text="让我为您操作微波炉，加热它"
                      type="text"/>
        <ManipVisonService service_name="/manip_vision_service"
                           server_timeout="5000"
                           object_name="open_button"
                           action_param="0"
                           camera_id="0"
                           est_pose="{est_pose}"
                           feedback="{manip_feedback}"/>
      </Parallel>
      <TfTransformPoseService service_name="/transform_pose"
                              server_timeout="5000"
                              source_pose="{est_pose}"
                              source_frame="camera_torso_link"
                              target_frame="torso_up_link"
                              target_pose="{tf_trans_result}"
                              feedback="{tf_trans_feedback}"/>
      <PoseMulService left_pose="-0.08;0;0;0;0;0;1"
                      right_pose="{tf_trans_result}"
                      result_pose="{pose_mul_result}"/>
      <CustomPoseService input_pose="{pose_mul_result}"
                         desired_pose="-;-;-;0.76118;-0.61292;0.10189;-0.18589"
                         result_pose="{custom_pose_result}"/>
      <HandAction server_name="/avaia_hand"
                  server_timeout="2000"
                  action_name="one_right"
                  success="{hand_success}"
                  status="{hand_status}"/>
      <ArmAction server_name="/arm"
                 server_timeout="30000"
                 action_name="move_to"
                 action_index="1"
                 action_param="0"
                 arm_index="1"
                 goal_left="0;0;0;0;0;0;1"
                 waypoints_left=""
                 goal_right="{custom_pose_result}"
                 waypoints_right="0;-30;0;0;0;0;0"
                 speed_percentage="20"
                 msg="{arm_msg}"
                 pose="{arm_pose}"/>
      <RetryUntilSuccessful num_attempts="5">
        <Sequence>
          <ManipVisonService service_name="/manip_vision_service"
                              server_timeout="5000"
                              object_name="finger"
                              action_param="0"
                              camera_id="0"
                              est_pose="{tcp_pose}"
                              feedback="{manip_feedback}"/>
          <ManipVisonService service_name="/manip_vision_service"
                              server_timeout="5000"
                              object_name="open_button"
                              action_param="0"
                              camera_id="0"
                              est_pose="{target_pose}"
                              feedback="{manip_feedback}"/>
          <PoseMulService left_pose="0;0;0.02;0;0;0;1"
                          right_pose="{target_pose}"
                          result_pose="{target_pose_trans}"/>
          <VisualCompensationService service_name="/visual_position_compensation"
                                      server_timeout="5000"
                                      target_pose="{target_pose_trans}"
                                      tcp_pose="{tcp_pose}"
                                      corrected_joints_left="{corrected_joints_left}"
                                      corrected_joints_right="{corrected_joints_right}"
                                      feedback="{compensation_feedback}"/>
        </Sequence>
      </RetryUntilSuccessful>
      <ArmAction server_name="/arm"
                 server_timeout="30000"
                 action_name="open_button"
                 action_index="0"
                 action_param="0"
                 arm_index="1"
                 goal_left="0;0;0;0;0;0;1"
                 waypoints_left="{corrected_joints_left}"
                 goal_right="0;0;0;0;0;0;1"
                 waypoints_right="{corrected_joints_right}"
                 speed_percentage="20"
                 msg="{arm_msg}"
                 pose="{arm_pose}"/>
      <ArmAction server_name="/arm"
                 server_timeout="30000"
                 action_name="back_to_pre_push_button"
                 action_index="1"
                 action_param="0"
                 arm_index="1"
                 goal_left="0;0;0;0;0;0;1"
                 waypoints_left=""
                 goal_right="{custom_pose_result}"
                 waypoints_right=""
                 speed_percentage="10"
                 msg="{arm_msg}"
                 pose="{arm_pose}"/>
      <ArmAction server_name="/arm"
                 server_timeout="30000"
                 action_name="back_to_pre_push_button"
                 action_index="0"
                 action_param="0"
                 arm_index="1"
                 goal_left="0;0;0;0;0;0;1"
                 waypoints_left=""
                 goal_right="0;0;0;0;0;0;1"
                 waypoints_right="0;-30;0;0;0;0;0;0;-5;0;0;0;0;0"
                 speed_percentage="30"
                 msg="{arm_msg}"
                 pose="{arm_pose}"/>
      <HandAction server_name="/avaia_hand"
                  server_timeout="2000"
                  action_name="reset_right"
                  success="{hand_success}"
                  status="{hand_status}"/>
    </Sequence>
  </BehaviorTree>
</root>